<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>物品升級遊戲</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #coin-display, #efficiency-display {
            position: absolute;
            top: 10px;
            font-size: 20px;
            font-weight: bold;
        }
        #coin-display { right: 10px; }
        #efficiency-display { left: 10px; }
        
        #game-container {
            display: flex;
            align-items: flex-start;
            gap: 20px;
        }
        
        #game-board {
            display: grid;
            grid-template-columns: repeat(6, 80px);
            grid-template-rows: repeat(6, 80px);
            gap: 5px;
            margin-top: 20px;
        }
        
        .cell {
            width: 80px;
            height: 80px;
            border: 1px solid #ccc;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .item {
            width: 100%;
            height: 100%;
            background-size: cover;
            cursor: pointer;
        }
        
        #controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
            position: relative;
        }
        
        #generate-btn-container {
            position: relative;
            display: inline-block;
        }
        
        #generate-btn {
            padding: 10px 20px;
            font-size: 16px;
        }
        
        #cost-display {
            font-size: 12px;
            color: gray;
            position: absolute;
            top: -8px;
            right: -10px;
        }
        
        #cheat-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }
        
        .cheat-btn {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #f0c040;
            border: none;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>物品升級遊戲</h1>
    <div id="coin-display">Coin: 0</div>
    <div id="efficiency-display">效率: 0 /秒</div>

    <div id="game-container">
        <div id="game-board"></div>
        
        <div id="controls">
            <div id="generate-btn-container">
                <button id="generate-btn">生成新物品</button>
                <div id="cost-display">消耗: 0</div>
            </div>
            <button id="earn-btn">賺錢</button>
            
            <div id="cheat-buttons">
                <button class="cheat-btn" id="speed-btn">時間加速</button>
                <button class="cheat-btn" id="double-coin-btn">聚寶盆</button>
                <button class="cheat-btn" id="win-start-btn">贏在起跑點</button>
            </div>
        </div>
    </div>

    <script>
        const boardSize = 6;
        const maxLevel = 10;
        const board = Array.from({ length: boardSize * boardSize }, () => null);
        let coin = 0;
        let generateCost = 0;
        let generateCount = 0;
        let productionRate = 0;
        let isBoosted = false;

        function createBoard() {
            const gameBoard = document.getElementById("game-board");
            gameBoard.innerHTML = '';
            board.forEach((item, index) => {
                const cell = document.createElement("div");
                cell.classList.add("cell");
                cell.dataset.index = index;
                cell.ondragover = (e) => e.preventDefault();
                cell.ondrop = (e) => handleDrop(e, index);
                if (item) {
                    const img = document.createElement("div");
                    img.classList.add("item");
                    img.style.backgroundImage = `url('pic${String(item).padStart(2, '0')}.png')`;
                    img.draggable = true;
                    img.dataset.level = item;
                    img.ondragstart = (e) => handleDragStart(e, index);
                    cell.appendChild(img);
                }
                gameBoard.appendChild(cell);
            });
            updateEfficiency();
        }

        function generateItem() {
            if (coin < generateCost) {
                alert("Coin 不足！");
                return;
            }
            if (generateCost > 0) coin -= generateCost;
            updateCoinDisplay();

            const emptyCells = board.map((item, index) => item === null ? index : null).filter(index => index !== null);
            if (emptyCells.length === 0) {
                alert("棋盤已滿！");
                return;
            }
            const randomIndex = emptyCells[Math.floor(Math.random() * emptyCells.length)];
            board[randomIndex] = 1;
            generateCount++;
            generateCost = Math.pow(2, generateCount - 1);
            updateCostDisplay();
            createBoard();
        }

        function handleDragStart(event, fromIndex) {
            event.dataTransfer.setData("fromIndex", fromIndex);
        }

        function handleDrop(event, toIndex) {
            const fromIndex = event.dataTransfer.getData("fromIndex");
            const fromLevel = board[fromIndex];
            const toLevel = board[toIndex];

            if (fromIndex !== toIndex) {
                if (toLevel === null) {
                    board[toIndex] = fromLevel;
                    board[fromIndex] = null;
                } else if (fromLevel === toLevel && fromLevel < maxLevel) {
                    board[toIndex] = toLevel + 1;
                    board[fromIndex] = null;
                }
                createBoard();
            }
        }

        function updateCoinDisplay() {
            document.getElementById("coin-display").innerText = `Coin: ${coin}`;
        }

        function updateCostDisplay() {
            document.getElementById("cost-display").innerText = `消耗: ${generateCost}`;
        }

        function updateEfficiency() {
            productionRate = board.reduce((rate, level) => rate + (level || 0), 0);
            const displayRate = isBoosted ? productionRate * 2 : productionRate;
            document.getElementById("efficiency-display").innerText = `效率: ${displayRate} /秒`;
        }

        function collectCoins() {
            const coinsToAdd = isBoosted ? productionRate * 2 : productionRate;
            coin += coinsToAdd;
            updateCoinDisplay();
        }

        function earnCoin() {
            coin += 1;
            updateCoinDisplay();
        }

        function applySpeedBoost() {
            if (isBoosted) return;
            isBoosted = true;
            updateEfficiency();
            setTimeout(() => {
                isBoosted = false;
                updateEfficiency();
            }, 30000);
        }

        function doubleCoin() {
            coin *= 2;
            updateCoinDisplay();
        }

        function generateHighLevelItem() {
            const emptyCells = board.map((item, index) => item === null ? index : null).filter(index => index !== null);
            if (emptyCells.length === 0) {
                alert("棋盤已滿！");
                return;
            }
            const randomIndex = emptyCells[Math.floor(Math.random() * emptyCells.length)];
            board[randomIndex] = maxLevel;
            createBoard();
        }

        document.getElementById("generate-btn").onclick = generateItem;
        document.getElementById("earn-btn").onclick = earnCoin;
        document.getElementById("speed-btn").onclick = applySpeedBoost;
        document.getElementById("double-coin-btn").onclick = doubleCoin;
        document.getElementById("win-start-btn").onclick = generateHighLevelItem;

        setInterval(collectCoins, 1000);

        createBoard();
        updateCoinDisplay();
        updateCostDisplay();
    </script>
</body>
</html>
